launch:
  - arg:
      name: "prefix"
      default: ""

  - arg:
      name: "serial_port"
      default: "/dev/ttyUSB0"

  - arg:
      name: "use_rviz"
      default: "true"

  - arg:
      name: "use_sim"
      default: "false"

  - arg:
      name: "rviz_config"
      default: $(find-pkg-share reach_description)/rviz/view_alpha.rviz

  - let:
      name: description_file
      value: $(find-pkg-share reach_description)/description/alpha_5/config.xacro

  - arg:
      name: robot_description
      default: $(command 'xacro $(var description_file) serial_port:=$(var serial_port) use_sim:=$(var use_sim) prefix:=$(var prefix)')

  - node:
      pkg: robot_state_publisher
      exec: robot_state_publisher
      param:
        - name: robot_description
          value: $(var robot_description)
        - name: use_sim_time
          value: $(var use_sim)

  - node:
      pkg: controller_manager
      exec: ros2_control_node
      param:
        - from: $(find-pkg-share reach_description)/config/alpha_5/controllers.yaml
        - name: use_sim_time
          value: $(var use_sim)
      remap:
        - from: /controller_manager/robot_description
          to: /robot_description

  - node:
      pkg: controller_manager
      exec: spawner
      args: joint_state_broadcaster --controller-manager controller_manager
      param:
        - name: use_sim_time
          value: $(var use_sim)

  - node:
      pkg: rviz2
      exec: rviz2
      if: $(var use_rviz)
      args: -d $(var rviz_config)
      param:
        - name: robot_description
          value: $(var robot_description)
        - name: use_sim_time
          value: $(var use_sim)
