launch:
  # Args
  - arg:
      name: "prefix"
      default: ""

  - arg:
      name: "ip_address"
      default: "192.168.2.3"

  - arg:
      name: "port"
      default: "6789"

  - arg:
      name: "use_rviz"
      default: "true"

  - arg:
      name: "use_sim"
      default: "false"

  - arg:
      name: "rviz_config"
      default: $(find-pkg-share reach_description)/rviz/bravo_7/view_bravo.rviz

  - let:
      name: description_file
      value: $(find-pkg-share reach_description)/description/bravo_7/config.xacro

  - arg:
      name: robot_description
      default: $(command 'xacro $(var description_file) ip_address:=$(var ip_address) port:=$(var port)')

  - arg:
      name: gz_world_file
      default: moon.world

  # Nodes
  - node:
      pkg: robot_state_publisher
      exec: robot_state_publisher
      param:
        - name: robot_description
          value: $(var robot_description)
        - name: use_sim_time
          value: $(var use_sim)

  - node:
      pkg: controller_manager
      exec: ros2_control_node
      param:
        - from: $(find-pkg-share reach_description)/config/bravo_7/controllers.yaml
        - name: use_sim_time
          value: $(var use_sim)
      remap:
        - from: /controller_manager/robot_description
          to: /robot_description

  - node:
      pkg: controller_manager
      exec: spawner
      args: joint_state_broadcaster --controller-manager controller_manager
      param:
        - name: use_sim_time
          value: $(var use_sim)

  - node:
      pkg: controller_manager
      exec: spawner
      args: impedance_controller --controller-manager controller_manager
      param:
        - name: use_sim_time
          value: $(var use_sim)

  - node:
      pkg: rviz2
      exec: rviz2
      if: $(var use_rviz)
      args: -d $(var rviz_config)
      param:
        - name: robot_description
          value: $(var robot_description)
        - name: use_sim_time
          value: $(var use_sim)

  - node:
      pkg: ros_gz_sim
      exec: create
      args: -name bravo -topic robot_description
      if: $(var use_sim)
      param:
        - name: use_sim_time
          value: $(var use_sim)

  - node:
      pkg: ros_gz_bridge
      exec: parameter_bridge
      args: /clock@rosgraph_msgs/msg/Clock[gz.msgs.Clock
      if: $(var use_sim)

  # Includes
  - include:
      file: $(find-pkg-share ros_gz_sim)/launch/gz_sim.launch.py
      if: $(var use_sim)
      arg:
        - name: gz_args
          value: -v4 -r $(var gz_world_file)
